<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi-Company Petri Dish – Arbitration & Class Action</title>

  <!-- D3 from CDN (like Plotly in your example) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #F9FAFB;      /* very light gray */
      color: #1F2937;           /* near-black text */
      margin: 0;
      padding: 1.5rem;
    }

    h1 {
      margin: 0 0 0.25rem 0;
      font-size: 1.4rem;
      font-weight: 600;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 1.5rem 0;
      font-size: 0.9rem;
      color: #9ca3af;
      text-align: center;
    }

    .controls {
      margin-bottom: 1.2rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      align-items: center;
    }

    select {
      background: #ffffff;
      color: #020617;
      border: 1px solid #4b5563;
      border-radius: 0.375rem;
      padding: 0.35rem 0.6rem;
      font-size: 0.9rem;
    }

    .container {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
      max-width: 1100px;
      margin: 0 auto;
    }

    .legend-box {
      min-width: 220px;
      max-width: 260px;
      background: #FFFFFF;
      border: 1px solid #D1D5DB;
      padding: 1rem;
      border-radius: 0.5rem;
      height: fit-content;
    }

    .legend-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.6rem;
    }

    .legend-section {
      margin-bottom: 1rem;
    }

    .legend-gradient {
      width: 100%;
      height: 14px;
      border-radius: 4px;
      margin-top: 0.25rem;
    }

    .legend-label {
      font-size: 0.8rem;
      margin-top: 0.35rem;
      margin-bottom: 0.15rem;
    }

    .company-label {
      margin-top: 0.3rem;
      font-size: 0.95rem;
      text-align: center;
    }

    svg {
      overflow: visible;
    }

    .label {
      font-size: 0.7rem;
      fill: #9ca3af;
      text-anchor: middle;
    }

    .arcA, .arcC {
      filter: drop-shadow(0px 1px 2px rgba(0,0,0,0.08));
    }

    .label.year-label {
      fill: #374151;
    }
  </style>
</head>

<body>
  <h1>Arbitration & Class Action “Petri Dish”</h1>
  <p class="subtitle">
    Inner ring: Arbitration severity · Outer ring: Class action severity · Each slice corresponds to a year
  </p>

  <div class="controls">
    <label for="company-select">Company:</label>
    <select id="company-select"></select>
  </div>

  <div class="company-label" id="company-label"></div>

  <div class="container">
    <!-- PETRI DISH GRAPH -->
    <svg id="petri" width="480" height="480"></svg>

    <!-- RIGHT-SIDE LEGEND -->
    <div class="legend-box">
      <div class="legend-title">Legend</div>

      <div class="legend-section">
        <div class="legend-label">Arbitration Severity (Inner Ring)</div>
        <div class="legend-gradient" style="background: linear-gradient(to right, #C8EEEA, #00A896);"></div>
        <div class="legend-label">Low → High severity</div>
      </div>

      <div class="legend-section">
        <div class="legend-label">Class Action Severity (Outer Ring)</div>
        <div class="legend-gradient" style="background: linear-gradient(to right, #F4C3B3, #BC2037);"></div>
        <div class="legend-label">Low → High severity</div>
      </div>

      <div class="legend-section">
        <div class="legend-label">Year Slices</div>
        <p style="font-size: 0.8rem; margin-top: 0.25rem;">
          Each slice around the circle represents a year.
          Larger arcs indicate higher severity in that category.
        </p>
      </div>

      <div class="legend-section">
        <p style="font-size: 0.75rem; color: #94a3b8;">
          Tip: Hover on any slice to view the exact year and scored severities.
        </p>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // INLINE DATA (IMPORTANT!)
    // =========================
    //
    // Replace this sample object with your real JSON from
    // petri_data_by_company.json. The expected shape is:
    //
    // {
    //   "Facebook": [
    //      { "year": 2015, "arbitration": 2.3, "classAction": 1.5 },
    //      { "year": 2016, "arbitration": 3.1, "classAction": 2.0 },
    //      ...
    //   ],
    //   "YouTube": [
    //      ...
    //   ],
    //   ...
    // }
    //
    const dataByCompany = {
  "YouTube": [
    {
      "year": 2015,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2017,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2018,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2019,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0,
      "classAction": 0.0
    }
  ],
  "Instagram": [
    {
      "year": 2015,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2017,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2018,
      "arbitration": 0.1176470588235294,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2019,
      "arbitration": 0.1176470588235294,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2020,
      "arbitration": 0.1176470588235294,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2021,
      "arbitration": 0.1176470588235294,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2022,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0,
      "classAction": 0.0
    }
  ],
  "WhatsApp": [
    {
      "year": 2015,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2017,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2018,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2019,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2020,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2021,
      "arbitration": 0.5882352941176471,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2022,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    }
  ],
  "TikTok": [
    {
      "year": 2019,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.1176470588235294,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.1176470588235294,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.9411764705882352,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2023,
      "arbitration": 0.9411764705882352,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2024,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    }
  ],
  "WeChat": [
    {
      "year": 2015,
      "arbitration": 0.1764705882352941,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2016,
      "arbitration": 0.1764705882352941,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2017,
      "arbitration": 0.1764705882352941,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2018,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2019,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2020,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2021,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2022,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2023,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2024,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2025,
      "arbitration": 0.3529411764705882,
      "classAction": 0.7058823529411765
    }
  ],
  "Telegram": [
    {
      "year": 2015,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2017,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2018,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2019,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0,
      "classAction": 0.0
    }
  ],
  "Snapchat": [
    {
      "year": 2018,
      "arbitration": 0.7058823529411765,
      "classAction": 0.0
    },
    {
      "year": 2019,
      "arbitration": 0.7058823529411765,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.7058823529411765,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.7058823529411765,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.7058823529411765,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.7058823529411765,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2024,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.7058823529411765,
      "classAction": 0.7058823529411765
    }
  ],
  "Reddit": [
    {
      "year": 2015,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2017,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2018,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2019,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.2941176470588235,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.3529411764705882,
      "classAction": 0.0
    }
  ],
  "Pinterest": [
    {
      "year": 2017,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2018,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2019,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2020,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2021,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2022,
      "arbitration": 0.3529411764705882,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2023,
      "arbitration": 0.5294117647058824,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2024,
      "arbitration": 0.5294117647058824,
      "classAction": 0.4117647058823529
    },
    {
      "year": 2025,
      "arbitration": 0.5294117647058824,
      "classAction": 0.4117647058823529
    }
  ],
  "LinkedIn": [
    {
      "year": 2015,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2016,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2017,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2018,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2019,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2020,
      "arbitration": 0.0,
      "classAction": 0.0
    },
    {
      "year": 2021,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2022,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.0588235294117647,
      "classAction": 0.0
    }
  ],
  "Discord": [
    {
      "year": 2019,
      "arbitration": 0.8235294117647058,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2020,
      "arbitration": 0.8235294117647058,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2021,
      "arbitration": 0.8235294117647058,
      "classAction": 0.7058823529411765
    },
    {
      "year": 2022,
      "arbitration": 0.9411764705882352,
      "classAction": 0.0
    },
    {
      "year": 2023,
      "arbitration": 0.9411764705882352,
      "classAction": 0.0
    },
    {
      "year": 2024,
      "arbitration": 0.9411764705882352,
      "classAction": 0.0
    },
    {
      "year": 2025,
      "arbitration": 0.9411764705882352,
      "classAction": 0.0
    }
  ]
};

    // =============== SETUP ===============
    const svg = d3.select("#petri");
    const width = +svg.attr("width");
    const height = +svg.attr("height");
    const radius = Math.min(width, height) / 2 - 10;

    const g = svg.append("g")
      .attr("transform", `translate(${width / 2}, ${height / 2})`);

    // Base dish circle
    g.append("circle")
      .attr("r", radius)
      .attr("fill", "#FFFFFF")
      .attr("stroke", "#D1D5DB")
      .attr("stroke-width", 1.5);

    const companySelect = document.getElementById("company-select");
    const companyLabel = document.getElementById("company-label");

    let globalMax = 1;

    // ==============================
    // INITIALIZE FROM INLINE DATA
    // ==============================
    (function init() {
      const companies = Object.keys(dataByCompany).sort();

      // Populate dropdown
      companies.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        companySelect.appendChild(opt);
      });

      // Global max for normalization (over all companies/years)
      const flat = Object.values(dataByCompany).flat();
      globalMax = d3.max(flat, d =>
        Math.max(d.arbitration || 0, d.classAction || 0)
      ) || 1;

      if (companies.length > 0) {
        companySelect.value = companies[0];
        updateCompany(companies[0]);
      }

      companySelect.addEventListener("change", e => {
        updateCompany(e.target.value);
      });
    })();

    function updateCompany(name) {
      const data = dataByCompany[name] || [];

      companyLabel.textContent = data.length
        ? `${name} (${d3.extent(data, d => d.year).join(" – ")})`
        : `${name} (No data)`;

      const n = Math.max(data.length, 1);
      const angle = (2 * Math.PI) / n;
      const pad = angle * 0.08;

      const innerBase = radius * 0.25;
      const innerThick = radius * 0.18;
      const outerBase = radius * 0.55;
      const outerThick = radius * 0.18;

      const innerScale = d3.scaleLinear()
        .domain([0, globalMax])
        .range([innerThick * 0.15, innerThick]);

      const outerScale = d3.scaleLinear()
        .domain([0, globalMax])
        .range([outerThick * 0.15, outerThick]);

      // Palette A: two-stop linear gradients from your palette
      const colA = d3.scaleLinear()
        .domain([0, globalMax])
        .range(["#C8EEEA", "#00A896"]);   // light teal → spark teal

      const colC = d3.scaleLinear()
        .domain([0, globalMax])
        .range(["#F4C3B3", "#BC2037"]);   // light warm red → Harvard red

      const arcA = d3.arc()
        .innerRadius(innerBase)
        .outerRadius(d => innerBase + innerScale(d.arbitration || 0))
        .startAngle((d, i) => i * angle + pad / 2)
        .endAngle((d, i) => (i + 1) * angle - pad / 2);

      const arcC = d3.arc()
        .innerRadius(outerBase)
        .outerRadius(d => outerBase + outerScale(d.classAction || 0))
        .startAngle((d, i) => i * angle + pad / 2)
        .endAngle((d, i) => (i + 1) * angle - pad / 2);

      // ----- INNER ARCS (ARBITRATION) WITH ANIMATION -----
      const inner = g.selectAll(".arcA")
        .data(data, d => d.year);

      inner.join(
        enter => enter.append("path")
          .attr("class", "arcA")
          .attr("d", d => {
            const smallArc = d3.arc()
              .innerRadius(innerBase)
              .outerRadius(innerBase);
            return smallArc(d);
          })
          .attr("fill", d => colA(d.arbitration || 0))
          .attr("stroke", "#020617")
          .attr("stroke-width", 0.5)
          .call(enter => enter.transition().duration(600)
            .attr("d", arcA)
          ),
        update => update
          .transition().duration(600)
          .attr("d", arcA)
          .attr("fill", d => colA(d.arbitration || 0)),
        exit => exit
          .transition().duration(300)
          .style("opacity", 0)
          .remove()
      );

      g.selectAll(".arcA").select("title").remove();
      g.selectAll(".arcA")
        .append("title")
        .text(d => `${name} – ${d.year}
Arbitration: ${d.arbitration}
Class action: ${d.classAction}`);

      // ----- OUTER ARCS (CLASS ACTION) WITH ANIMATION -----
      const outer = g.selectAll(".arcC")
        .data(data, d => d.year);

      outer.join(
        enter => enter.append("path")
          .attr("class", "arcC")
          .attr("d", d => {
            const smallArc = d3.arc()
              .innerRadius(outerBase)
              .outerRadius(outerBase);
            return smallArc(d);
          })
          .attr("fill", d => colC(d.classAction || 0))
          .attr("stroke", "#020617")
          .attr("stroke-width", 0.5)
          .call(enter => enter.transition().duration(600)
            .attr("d", arcC)
          ),
        update => update
          .transition().duration(600)
          .attr("d", arcC)
          .attr("fill", d => colC(d.classAction || 0)),
        exit => exit
          .transition().duration(300)
          .style("opacity", 0)
          .remove()
      );

      g.selectAll(".arcC").select("title").remove();
      g.selectAll(".arcC")
        .append("title")
        .text(d => `${name} – ${d.year}
Arbitration: ${d.arbitration}
Class action: ${d.classAction}`);

      // ----- YEAR LABELS WITH ANIMATION -----
      const rLab = outerBase + outerThick + 16;

      const labels = g.selectAll(".year-label")
        .data(data, d => d.year);

      labels.join(
        enter => enter.append("text")
          .attr("class", "label year-label")
          .attr("x", (d, i) =>
            rLab * Math.sin(i * angle + angle / 2)
          )
          .attr("y", (d, i) =>
            -rLab * Math.cos(i * angle + angle / 2)
          )
          .style("opacity", 0)
          .text(d => d.year)
          .call(enter => enter.transition().duration(600)
            .style("opacity", 1)
          ),
        update => update.transition().duration(600)
          .attr("x", (d, i) =>
            rLab * Math.sin(i * angle + angle / 2)
          )
          .attr("y", (d, i) =>
            -rLab * Math.cos(i * angle + angle / 2)
          )
          .text(d => d.year),
        exit => exit
          .transition().duration(300)
          .style("opacity", 0)
          .remove()
      );
    }
  </script>
</body>
</html>
